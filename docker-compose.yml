version: '3.8'
services:
  redis:
    image: redis:7-alpine
    ports: ["6379:6379"]
  mailcatcher:
    image: schickling/mailcatcher
    ports: ["1080:1080", "1025:1025"]
  web:
    build: .
    ports: ["3000:3000"]
    environment:
      - REDIS_URL=redis://redis:6379/0
      - SMTP_HOST=mailcatcher
      - SMTP_PORT=1025
    depends_on: [redis, mailcatcher]
    volumes: [".:/app"]
  sidekiq:
    build: .
    command: bundle exec sidekiq
    environment:
      - REDIS_URL=redis://redis:6379/0
      - SMTP_HOST=mailcatcher
      - SMTP_PORT=1025
    depends_on: [redis, mailcatcher]
    volumes: [".:/app"]